<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AB Studio AI Chat</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style>
        body {
            font-family: sans-serif;
            margin: 0;
            padding: 0;
            background-color: #1a1a1a;
            color: white;
            display: flex;
            flex-direction: column;
            height: 100vh;
        }
        .chat-header {
            background-color: #222;
            color: white;
            padding: 15px;
            text-align: center;
            font-size: 1.5em;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 100;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }
         .chat-header span {
             margin-right: 8px;
            vertical-align: middle;
        }
         .chat-container {
           flex: 1;
           display: flex;
           flex-direction: column;
           overflow: hidden;
           margin-top: 60px;
        }
        .chat-body {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
             display: flex;
            flex-direction: column;
        }
        .message {
            margin-bottom: 10px;
            padding: 10px;
            border-radius: 8px;
            max-width: 80%;
            word-wrap: break-word;
              white-space: pre-line;
        }
        .user-message {
            background-color: #333;
            color: white;
            align-self: flex-end;
        }
        .bot-message {
            background-color: #444;
             color: white;
            align-self: flex-start;
        }
        .chat-input {
            padding: 10px;
            display: flex;
            border-top: 1px solid #333;
        }
        .chat-input input {
            flex: 1;
            padding: 8px;
            border: 1px solid #555;
            border-radius: 4px;
            background-color: #333;
              color: white;
        }
        .admin-panel {
            padding: 20px;
            background-color: #222;
            border-radius: 8px;
             margin-bottom:15px;
           text-align:center;
            display: none; /* Initially hide the admin panel */
        }
         .admin-panel h2{
            text-align: center;
             margin-bottom:20px;

        }
         .admin-panel button {
            background-color: #555;
             color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .admin-panel button:hover {
            background-color: #666;
        }
        .admin-panel textarea {
            width: calc(100% - 22px);
            height: 100px;
            padding: 8px;
             border: 1px solid #555;
              border-radius: 4px;
            background-color: #333;
             color: white;
             margin-bottom:10px;
        }
       .admin-panel input {
            padding: 8px;
            border: 1px solid #555;
            border-radius: 4px;
            background-color: #333;
              color: white;
              margin-bottom:10px;
        }
       .chat-input button {
            background-color: #444;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            margin-left: 5px;
        }
        .chat-input button:hover {
            background-color: #555;
        }
        .login-panel {
            padding: 20px;
             text-align: center;
            background-color: #222;
            border-radius: 8px;
            margin: 20px auto;
            width: 300px;
        }
       .login-panel input {
            padding: 8px;
            border: 1px solid #555;
            border-radius: 4px;
            background-color: #333;
              color: white;
              margin-bottom:10px;
           width: calc(100% - 20px);
        }
        .login-panel button {
            background-color: #555;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 10px;
        }
           .login-panel button:hover {
            background-color: #666;
        }
       ::-webkit-scrollbar {
         width: 8px;
         }

       ::-webkit-scrollbar-thumb {
         background-color: #666;
        border-radius: 4px;
        }

     ::-webkit-scrollbar-track {
           background-color: #222;
        }
        .error-message {
            color: red;
            margin-top: 10px;
        }

    </style>
</head>
<body>
    <header class="chat-header">
          <span class="material-icons">android</span>
        AB Studio AI
    </header>
     <div class="login-panel" id="login-panel">
        <h2>Admin Login</h2>
        <input type="email" id="admin-email" placeholder="Email"/>
        <input type="password" id="admin-password" placeholder="Password" />
        <button id="admin-login-button">Login</button>
          <p class="error-message" id="error-message" style="display: none;">Invalid email or password</p>
    </div>
    <div class="admin-panel" id="admin-panel">
           <h2>Admin Panel</h2>

          <input type="text" id="admin-input-key" placeholder="Enter keyword" style="width:calc(40% - 12px);"/>
        <textarea  id="admin-textarea" placeholder="Enter response"></textarea>
          <button id="add-response-button">Add Response</button>
           <button id="edit-response-button">Edit Response</button>
             <button id="delete-response-button">Delete Response</button>
         </div>

    <div class="chat-container">
        <div class="chat-body" id="chat-body">
        </div>
         <div class="chat-input">
            <input type="text" id="user-input" placeholder="Type your message...">
            <button id="send-button">Send</button>
        </div>
    </div>

    <script type="module">
          // Import the functions you need from the SDKs you need
          import { initializeApp } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-app.js";
          import { getDatabase, ref, onValue ,set ,remove} from "https://www.gstatic.com/firebasejs/11.2.0/firebase-database.js";
        
          // Your web app's Firebase configuration
          const firebaseConfig = {
            apiKey: "AIzaSyBW1WPXUN8DYhT6npZQYoQ3l4J-jFSbzfg",
            authDomain: "ab-studio-marketcap.firebaseapp.com",
            databaseURL: "https://ab-studio-marketcap-default-rtdb.firebaseio.com",
            projectId: "ab-studio-marketcap",
            storageBucket: "ab-studio-marketcap.firebasestorage.app",
            messagingSenderId: "115268088088",
            appId: "1:115268088088:web:65643a047f92bfaa66ee6d"
          };
        
          // Initialize Firebase
          const app = initializeApp(firebaseConfig);
           const database = getDatabase(app);
        const chatBody = document.getElementById('chat-body');
        const userInput = document.getElementById('user-input');
        const sendButton = document.getElementById('send-button');
          const adminLoginButton = document.getElementById('admin-login-button');
         const loginPanel = document.getElementById('login-panel');
        const adminPanel = document.getElementById('admin-panel');
           const errorMessage = document.getElementById('error-message');
         const adminInputKey= document.getElementById('admin-input-key');
        const adminTextArea = document.getElementById('admin-textarea');
        const addResponseButton = document.getElementById('add-response-button');
         const editResponseButton = document.getElementById('edit-response-button');
          const deleteResponseButton = document.getElementById('delete-response-button');
        const adminEmailInput = document.getElementById('admin-email');
        const adminPasswordInput = document.getElementById('admin-password');

          const dbRef = ref(database, 'chatbotResponses');
            let chatbotResponses = {};
            onValue(dbRef, (snapshot) => {
              chatbotResponses = snapshot.val();
              console.log(chatbotResponses)
            });

        function sendMessage(message, isUser) {
            const messageElement = document.createElement('div');
            messageElement.classList.add('message');
            if(isUser) {
                messageElement.classList.add('user-message');
                messageElement.textContent = message;
            } else {
                messageElement.classList.add('bot-message');
                messageElement.textContent = message;
            }
            chatBody.appendChild(messageElement);
            chatBody.scrollTop = chatBody.scrollHeight;
        }

           function getBotResponse(message) {
            const lowercaseMessage = message.toLowerCase().trim();
            if(chatbotResponses && chatbotResponses[lowercaseMessage]){
               return chatbotResponses[lowercaseMessage];
            } else{
                return "I'm sorry, I don't understand that yet.";
            }
        }
        sendButton.addEventListener('click', () => {
            const message = userInput.value.trim();
            if(message) {
                sendMessage(message, true);
                userInput.value = '';
                 const botResponse = getBotResponse(message);
                   setTimeout(() => {
                    sendMessage(botResponse,false);
                }, 500);
            }
        });

        userInput.addEventListener('keydown', (event) => {
            if(event.key === 'Enter') {
                sendButton.click();
                event.preventDefault();
            }
        });
         adminLoginButton.addEventListener('click', () => {
             const email = adminEmailInput.value;
             const password = adminPasswordInput.value;
             // Replace with your actual email and password
            if (email === 'abcoinseo@gmail.com' && password === 'asrabu123') {
                loginPanel.style.display = 'none';
                adminPanel.style.display = 'block';
                 errorMessage.style.display = 'none';
            } else {
              errorMessage.style.display = 'block';
            }
        });
          addResponseButton.addEventListener('click', () => {
             const key = adminInputKey.value.trim();
               const response = adminTextArea.value.trim();
            if (key && response) {
               set(ref(database, 'chatbotResponses/' + key),response)
                    .then(() => {
                    console.log('Response added successfully!');
                     adminInputKey.value ="";
                     adminTextArea.value = "";
                    })
                    .catch((error) => {
                    console.error('Error adding response:', error);
                     });
                   }
               });

            editResponseButton.addEventListener('click', () => {
               const key = adminInputKey.value.trim();
             const response = adminTextArea.value.trim();
               if (key && response) {
                    set(ref(database, 'chatbotResponses/' + key), response)
                      .then(() => {
                        console.log('Response edited successfully!');
                        adminInputKey.value ="";
                         adminTextArea.value = "";
                      })
                      .catch((error) => {
                        console.error('Error editing response:', error);
                    });
               }
             });
         deleteResponseButton.addEventListener('click', () => {
             const key = adminInputKey.value.trim();
               if (key) {
                 remove(ref(database, 'chatbotResponses/' + key))
                    .then(() => {
                        console.log('Response deleted successfully!');
                          adminInputKey.value ="";
                            adminTextArea.value = "";
                     })
                      .catch((error) => {
                     console.error('Error deleting response:', error);
                   });
                }
            });

    </script>
</body>
</html>
